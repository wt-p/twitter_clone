import random
from django.contrib.auth import get_user_model
from django.core.management.base import BaseCommand
from tweets.models import Tweet
from users.models import Follow

# ã“ã‚Œã§ç¾åœ¨æœ‰åŠ¹ãªUserã‚¯ãƒ©ã‚¹ãŒå–å¾—ã§ãã‚‹
User = get_user_model()


class Command(BaseCommand):
    help = 'ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãƒ„ã‚¤ãƒ¼ãƒˆã€ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚ã‚’ç”Ÿæˆã™ã‚‹ã‚³ãƒãƒ³ãƒ‰'

    def handle(self, *args, **kwargs):
        self.stdout.write('seedãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...')

        # 1. ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆï¼ˆ20äººï¼‰
        self.stdout.write('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç”Ÿæˆä¸­...')
        for i in range(20):
            username = f'testuser_{i}'
            if not User.objects.filter(username=username).exists():
                User.objects.create_user(
                    username=username,
                    email=f'{username}@example.com',
                    password='password123',
                    display_name=f'ãƒ¦ãƒ¼ã‚¶ãƒ¼_{i}',
                    bio=f'ã“ã‚“ã«ã¡ã¯ã€{username}ã§ã™ã€‚',
                )
        # æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚è¿½åŠ 
        all_users = list(User.objects.all())

        tweet = [
            # é–‹ç™ºãƒ»ä»•äº‹ç³»
            'ä»Šæ—¥ã‚‚1æ—¥ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼é€²æ—ãƒ€ãƒ¡ã§ã™ï¼ ğŸ« ',
            'ãƒ‡ãƒ—ãƒ­ã‚¤ç›´å‰ã®ç·Šå¼µæ„Ÿã€ä½•å›ã‚„ã£ã¦ã‚‚æ…£ã‚Œãªã„ã‚...',
            'ãƒã‚°ãŒå–ã‚Œãªãã¦3æ™‚é–“ã€‚åŸå› ã¯ã‚¿ã‚¤ãƒã§ã—ãŸã€‚è§£æ•£ï¼ ğŸ™„',
            'ã‚«ãƒ•ã‚§ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã¨æ—ã‚‹æ°—ãŒã™ã‚‹ã®ã¯ä½•ã§ã ã‚ã†ã€‚ â˜•',

            # æ—¥å¸¸ãƒ»é£Ÿäº‹ç³»
            'ãŠæ˜¼ã”ã¯ã‚“ã€ä½•é£Ÿã¹ã‚ˆã†ã‹ãªã€‚ãƒ©ãƒ¼ãƒ¡ãƒ³ã®å£ã«ãªã£ã¦ã‚‹ ğŸœ',
            'çµå±€ã€å®¶ã®ã‚«ãƒ¬ãƒ¼ãŒä¸€ç•ªç¾å‘³ã—ã„èª¬ ğŸ›',
            'ã‚³ãƒ³ãƒ“ãƒ‹ã®æ–°ä½œã‚¹ã‚¤ãƒ¼ãƒ„ã€ã¤ã„ã¤ã„è²·ã£ã¡ã‚ƒã†ã‚ˆã­ã€‚ ğŸ°',
            'æœèµ·ããŸã‚‰å–‰ãŒç—›ã„...ã€‚ã¿ã‚“ãªã‚‚é¢¨é‚ªã«ã¯æ°—ã‚’ã¤ã‘ã¦ï¼ ğŸ˜·',

            # è¶£å‘³ãƒ»ã¤ã¶ã‚„ã
            'é€±æœ«ã®å¤©æ°—ãŒè‰¯ã•ãã†ã§å¬‰ã—ã„ï¼ã‚­ãƒ£ãƒ³ãƒ—è¡ŒããŸã„ â›º',
            'æœ€è¿‘è²·ã£ãŸã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒæœ€é«˜ã™ãã¦ã€ç„¡é§„ã«ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦ã‚‹ âŒ¨ï¸',
            'ç©èª­ãŒæºœã¾ã£ã¦ã„ãä¸€æ–¹...ã€‚æ™‚é–“ãŒè¶³ã‚Šãªã„ï¼ ğŸ“š',
            'æ¨ã—ã®æ–°æ›²ãŒè‰¯ã™ãã¦ã‚‚ã†ç„¡é™ãƒ«ãƒ¼ãƒ—ã—ã¦ã‚‹ ğŸ§',

            # ã‚ã‚‹ã‚ã‚‹ç³»
            'ãƒ•ã‚©ãƒ­ãƒ¼å¤–ã‹ã‚‰å¤±ç¤¼ã—ã¾ã™ï¼ã“ã‚Œã‚ã£ã¡ã‚ƒã‚ã‹ã‚Šã¾ã™ ğŸ¤',
            'ã‚ã€ã‚‚ã†ã“ã‚“ãªæ™‚é–“...ã€‚SNSè¦‹ã¦ã‚‹ã¨æ™‚é–“æº¶ã‘ã‚‹ã®æ—©ã™ã â°',
            'ä¹…ã—ã¶ã‚Šã«å®Ÿå®¶ã«å¸°ã£ãŸã‚‰ã€çŒ«ã«å¿˜ã‚Œã‚‰ã‚Œã¦ã¦æ³£ã„ãŸ ğŸˆ',
            'æ•£æ­©ä¸­ã«è¦‹ã‹ã‘ãŸç©ºãŒç¶ºéº—ã ã£ãŸã®ã§å…±æœ‰ â˜ï¸',
            'ç­‹ãƒˆãƒ¬å§‹ã‚ã¦3æ—¥ç›®ã€‚ä»Šã®ã¨ã“ã‚ç­‹è‚‰ç—›ã¨ã®æˆ¦ã„ ğŸ’ª',
            'ã€Œæ˜æ—¥ã‹ã‚‰æœ¬æ°—å‡ºã™ã€ã‚’ã‚‚ã†3æ—¥è¨€ã£ã¦ã‚‹ ğŸ›Œ',
        ]

        # 2. ãƒ„ã‚¤ãƒ¼ãƒˆã®ä½œæˆ
        self.stdout.write('ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...')
        for user in all_users:
            for _ in range(random.randint(3, 10)):
                # IDã‚’æŒ¯ã‚‹ã“ã¨ã§ãƒ„ã‚¤ãƒ¼ãƒˆã‚’è¦‹åˆ†ã‘ã‚„ã™ãã™ã‚‹ãŸã‚
                content = random.choice(tweet) + f'(ID: {random.randint(1, 999)})'
                Tweet.objects.create(
                    user=user,
                    content=content
                )

        # 3. ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚ã®ç”Ÿæˆ
        self.stdout.write('ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚ã‚’ç”Ÿæˆä¸­...')
        for user in all_users:
            # è‡ªåˆ†ä»¥å¤–ã‚’æŠ½å‡º
            other_users = [u for u in all_users if u != user]
            # 1ã€œ5äººã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã‚“ã§ãƒ•ã‚©ãƒ­ãƒ¼
            targets = random.sample(other_users, k=random.randint(1, 5))
            for target in targets:
                # é‡è¤‡ã—ã¦ä½œæˆã•ã‚Œãªã„ã‚ˆã†ã« get_or_create ã‚’ä½¿ç”¨
                Follow.objects.get_or_create(follower=user, followee=target)

        self.stdout.write(self.style.SUCCESS('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼'))
