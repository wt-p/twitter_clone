{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="twitter-card">

        <div class="twitter-header">
            <i class="fab fa-twitter twitter-icon"></i>
            <h2 class="twitter-title">新しいパスワードを作成</h2>
        </div>

        <!-- Allauthがパスワード再設定画面専用に用意した特殊な変数名 -->
        {% if token_fail %}
            <p class="twitter-muted-text text-center">
                このパスワード再設定リンクは無効か、期限切れです。
            </p>
            <a href="{% url 'account_reset_password' %}" class="twitter-btn-primary mt-4 text-center">新しくリクエストする</a>
        {% else %}
            <!-- パスワード再設定用のURLには、セキュリティのためにユーザーごとに異なる「秘密のキー」が含まれる必要があるため、-->
            <!-- 固定の文字列ではなく、システムがその都度生成した action_url という変数を使う決まりになっているそう -->
            <form method="POST" action="{{ action_url }}">
                {% csrf_token %}

                {% for field in form %}
                <div class="twitter-form-group {% if field.errors %}has-error{% endif %}">
                    <label for="{{ field.id_for_label }}" class="twitter-label">{{ field.label }}</label>
                    {{ field }}
                    <!-- 最初のループ（password1）のみに表示したいhelpテキストのためforloop.firstを使用 -->
                    {% if forloop.first %}
                        <div class="twitter-help-text-static">
                            ・他の個人情報と似ているパスワードにはできません。<br>
                            ・パスワードは最低8文字以上必要です。<br>
                            ・数字だけのパスワードにはできません。<br>
                        </div>
                    {% endif %}

                    {% if field.errors %}
                        {% for error in field.errors %}
                            <div class="twitter-error-text">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
                {% endfor %}

                <button type="submit" class="twitter-btn-primary mt-4">パスワードを変更</button>
            </form>
        {% endif %}

    </div>
</div>
{% endblock %}